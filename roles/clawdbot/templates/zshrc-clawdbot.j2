# Enable 256 colors
export TERM=xterm-256color
export COLORTERM=truecolor

{% if ansible_os_family == 'Debian' %}
# XDG and DBus configuration for systemd user services
export XDG_RUNTIME_DIR=/run/user/$(id -u)
if [ -z "$DBUS_SESSION_BUS_ADDRESS" ]; then
  if [ -f "${XDG_RUNTIME_DIR}/bus" ]; then
    export DBUS_SESSION_BUS_ADDRESS="unix:path=${XDG_RUNTIME_DIR}/bus"
  fi
fi
{% endif %}

# Add Homebrew to PATH
{% if ansible_os_family == 'Darwin' %}
eval "$(/opt/homebrew/bin/brew shellenv)"
{% else %}
if [ -x /home/linuxbrew/.linuxbrew/bin/brew ]; then
  eval "$(/home/linuxbrew/.linuxbrew/bin/brew shellenv)"
fi
{% endif %}

# Add pnpm to PATH
export PNPM_HOME="{{ clawdbot_home }}/.local/share/pnpm"
export PATH="{{ clawdbot_home }}/.local/bin:$PNPM_HOME:$PATH"

# Color support for common tools
export CLICOLOR=1
{% if ansible_os_family == 'Darwin' %}
export LSCOLORS=ExFxCxDxBxegedabagacad
alias ls='ls -G'
{% else %}
export LS_COLORS='di=34:ln=35:so=32:pi=33:ex=31:bd=34;46:cd=34;43:su=30;41:sg=30;46:tw=30;42:ow=30;43'
alias ls='ls --color=auto'
{% endif %}
alias grep='grep --color=auto'
alias ll='ls -lah'

# Clawdbot dashboard info (shown on login)
_show_clawdbot_info() {
  echo ""
  echo "╔════════════════════════════════════════════════════════╗"
  echo "║         Clawdbot Dashboard                             ║"
  echo "╚════════════════════════════════════════════════════════╝"
  echo ""
  echo "  Dashboard URL: http://$(hostname -I | awk '{print $1}'):{{ clawdbot_gateway_port }}/"
  echo ""
{% if clawdbot_gateway_token %}
  echo "  Auth Token: {{ clawdbot_gateway_token }}"
{% else %}
  echo "  Auth Token: Run 'clawdbot config get gateway.auth.token' to retrieve"
{% endif %}
  echo ""
  echo "  Quick Commands:"
  echo "    clawdbot gateway status          # Check gateway status"
  echo "    clawdbot onboard --no-install-daemon  # Complete setup wizard"
  echo "    clawdbot channels login          # Connect messaging provider"
  echo "    clawdbot config set <k> <v>      # Change settings"
  echo ""
}

# Show dashboard info on interactive login
if [[ -o interactive ]]; then
  _show_clawdbot_info
fi
